<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hello</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="title: “2048”date: 2015-02-05 16:59:18tags: [js,html]categories: [html]


.main{
    width:400px;
    height:400px;
    margin:0 auto;
    margin-top: 50px;
}
.row{
    clear:both;
}
.cell{
    float:">
<meta property="og:type" content="article">
<meta property="og:title" content="Hello">
<meta property="og:url" content="http://johnfanyong.github.io/2015/02/05/2048/">
<meta property="og:site_name" content="Hello">
<meta property="og:description" content="title: “2048”date: 2015-02-05 16:59:18tags: [js,html]categories: [html]


.main{
    width:400px;
    height:400px;
    margin:0 auto;
    margin-top: 50px;
}
.row{
    clear:both;
}
.cell{
    float:">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hello">
<meta name="twitter:description" content="title: “2048”date: 2015-02-05 16:59:18tags: [js,html]categories: [html]


.main{
    width:400px;
    height:400px;
    margin:0 auto;
    margin-top: 50px;
}
.row{
    clear:both;
}
.cell{
    float:">

  
    <link rel="alternative" href="/atom.xml" title="Hello" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hello</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://johnfanyong.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2048" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/02/05/2048/" class="article-date">
  <time datetime="2015-02-05T08:59:18.000Z" itemprop="datePublished">2月 5 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>title: “2048”<br>date: 2015-02-05 16:59:18<br>tags: [js,html]<br>categories: [html]</p>
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<style>
.main{
    width:400px;
    height:400px;
    margin:0 auto;
    margin-top: 50px;
}
.row{
    clear:both;
}
.cell{
    float:left;
    display:block;
    height:98px;
    width:98px;
    line-height: 100px;
    background-color:#CCC;
    border:thin solid #000;
    text-align: center;
}
.cell2{
    background-color: #F0F8FF;    font-size: 78px;
}
.cell4{
    background-color: #FAEBD7;    font-size: 78px;
}
.cell8{
    background-color: #DEB887;    font-size: 78px;
}
.cell16{
    background-color: #B8860B;    font-size: 78px;
}
.cell32{
    background-color: #E9967A;    font-size: 78px;
}
.cell64{
    background-color: #D19275;    font-size: 78px;
}
.cell128{
    background-color: #FF00FF;    font-size: 64px;
}
.cell256{
    background-color: #FFD700;    font-size: 64px;
}
.cell512{
    background-color: #ADFF2F;    font-size: 64px;
}
.cell1024{
    background-color: #87CEFA;    font-size: 48px;
}
.cellBiger{
    background-color: #8470FF;    font-size: 38px;
}
</style>
<script type="text/javascript">
    (function(){
        var keynum,
        getKeyNum = function(e){        
            if(window.event) // IE
            {
                keynum = window.event.keyCode;
            }
            else if(e.which) // Netscape/Firefox/Opera
            {
                keynum = e.which;
            }
            switch(keynum){
                case 37:moveLeft();break;
                case 38:moveUp();break;
                case 39:moveRight();break;
                case 40:moveDown();break;
            }
            return false;
        },
        init = function(){
            createNewCellValue(2);
            document.onkeydown = function(e){
                getKeyNum(e);
            };
        },
        moveUp = function(){
            moveColumn('up');
        },
        moveDown = function(){
            moveColumn('down');
        },
        moveLeft = function(){
            moveRow('left');
        },
        moveRight = function(){
            moveRow('right');
        },
        moveRow = function(direction){
            if(!canMove(direction)){
                var emptyCell = getEmptyCell();
                var gameOver = isGameOver(emptyCell);
                return;
            }
            for(var rowIndex=1;rowIndex<5;rowIndex++){
                var val=[],newVal=[];
                for(var i=1;i<5;i++){
                    if(getValue('c'+rowIndex+''+i)>0){
                        val[val.length]=getValue('c'+rowIndex+''+i);
                    }
                }
                if(direction=='left'){
                    newVal = calculateValue(val);
                    for(var i=0;i<newVal.length;i++){
                        setValue(('c'+rowIndex+''+(i+1)),newVal[i]);
                    }
                    for(var i=0;i<(4-newVal.length);i++){
                        setValue(('c'+rowIndex+''+(4-i)),'');
                    }
                }else if(direction=='right'){
                    newVal = calculateValue(val.reverse());
                    for(var i=0;i<newVal.length;i++){
                        setValue(('c'+rowIndex+''+(4-i)),newVal[i]);
                    }
                    for(var i=0;i<(4-newVal.length);i++){
                        setValue(('c'+rowIndex+''+(1+i)),'');
                    }
                }
            }
            createNewCellValue();
        },
        moveColumn = function(direction){
            if(!canMove(direction)){
                var emptyCell = getEmptyCell();
                var gameOver = isGameOver(emptyCell);
                if(gameOver){
                    alert('Game Over');
                }
                return;
            }
            for(var colIndex=1;colIndex<5;colIndex++){
                var val=[],newVal=[];
                for(var i=1;i<5;i++){
                    if(getValue('c'+i+''+colIndex)>0){
                        val[val.length]=getValue('c'+i+''+colIndex);
                    }
                }
                if(direction=='up'){
                    newVal = calculateValue(val);
                    for(var i=0;i<newVal.length;i++){
                        setValue(('c'+(i+1)+''+colIndex),newVal[i]);
                    }
                    for(var i=0;i<(4-newVal.length);i++){
                        setValue(('c'+(4-i)+''+colIndex),'');
                    }
                }else if(direction=='down'){
                    newVal = calculateValue(val.reverse());
                    for(var i=0;i<newVal.length;i++){
                        setValue(('c'+(4-i)+''+colIndex),newVal[i]);
                    }
                    for(var i=0;i<(4-newVal.length);i++){
                        setValue(('c'+(1+i)+''+colIndex),'');
                    }
                }
            }
            createNewCellValue();

        },
        calculateValue = function(arr){
            var rtn = [],hasRepeat=false;

            for(var i=0;i<arr.length;i++){
                if(arr[i]==arr[i+1]&&!hasRepeat){
                    rtn[rtn.length]=arr[i]*2;
                    i+=1;
                    if(i>arr.length){
                        break;
                    }
                    hasRepeat=true
                }else{
                    rtn[rtn.length]=arr[i];
                }
            }
            return rtn;
        },
        getValue = function(emId){
            console.log(emId);
            if(typeof(emId)=='string'){
                return document.getElementById(emId).innerText*1;
            }else{
                return emId.innerText*1;    
            }

        },
        setValue = function(emId,val){
            if(typeof(emId)=='string'){
                document.getElementById(emId).innerText=val=='0'?'':val;
                if(val!=0){
                    document.getElementById(emId).className='cell cell'+(val>1024?'Biger':val);
                }else{
                    document.getElementById(emId).className='cell';
                }
            }else{
                emId.innerText=val=='0'?'':val;
                if(val!=0){
                    emId.className='cell cell'+(val>1024?'Biger':val);
                }else{
                    emId.className='cell';
                }
            }

        },
        createNewNum = function(){
            var randomNum = Math.random();
            if(randomNum>0.3){
                return 2;
            }else{
                return 4;    
            }
        },
        createNewCellValue = function(count){
            var num = createNewNum();
            var emptyCell = getEmptyCell();
            var gameOver = isGameOver(emptyCell);
            if(gameOver){
                alert('game over');
            }else{
                if(emptyCell.length>0){
                    if(!count){
                        count = 1;    
                    }
                    for(var i=0;i<count;i++){
                        var index = getRandomNum(1,emptyCell.length);
                        setValue(emptyCell[index-1],num);
                    }

                }
            }

        },
        getRandomNum = function(Min,Max)
        {   
            var Range = Max - Min;   
            var Rand = Math.random();   
            return(Min + Math.round(Rand * Range));   
        },
        getEmptyCell = function(){
            var emptyCells = [];
            var cells = document.getElementsByTagName('span');
            for(var i=0,l=cells.length;i<l;i<i++){
                if(getValue(cells[i])==0){
                    emptyCells[emptyCells.length]=cells[i];
                }
            }
            return emptyCells;
        },
        test = function(a){
            for(var i=0;i<a;i++){
                var num = getRandomNum(1,a);
                document.writeln(num);
            }    
        },
        //�Ƿ������ƶ�
        canMove = function(direction){
            for(var i=1;i<5;i++){
                for(var j=1;j<5;j++){
                    var c = getValue('c'+i+''+j),
                        cNext;
                    if(c==0){
                        continue;
                    }
                    switch(direction){
                        case 'up':
                            if(i==1){
                                continue;
                            }
                            cNext = getValue('c'+(i-1)+''+j);
                            break;
                        case 'down':
                            if(i==4){
                                continue;
                            }
                            cNext = getValue('c'+(i+1)+''+j);
                            break;
                        case 'left':
                            if(j==1){
                                continue;
                            }
                            cNext = getValue('c'+i+''+(j-1));
                            break;
                        case 'right':
                            if(j==4){
                                continue;
                            }
                            cNext = getValue('c'+i+''+(j+1));
                            break;
                    }

                    //���ڵĵ�Ԫ��Ϊ�գ�������ͬ����ʾ�����ƶ�    
                    if(cNext==0||cNext==c){
                        return true;
                    }
                }
            }
            return false;
        },
        //�ж���Ϸ�Ƿ�ʧ��
        isGameOver = function(emptyCell){
            if(emptyCell.length>0){
                return false;
            }else{
                for(var i=1;i<5;i++){
                    for(var j=1;j<5;j++){
                        var c = getValue('c'+i+''+j),
                            cRight=j+1==5?null:getValue('c'+i+''+(j+1)),
                            cDown=i+1==5?null:getValue('c'+(i+1)+''+j);
                        if(c==cRight||c==cDown){
                            return false;
                        }
                    }
                }    
            }
            return true;
        };

        window.Game={
            getKeyNum : getKeyNum,
            getRandomNum : getRandomNum,
            init:init
        }
    })();
</script>

<p></p>
<body onload="Game.init();"><br><div class="main"><br>    <div class="row"><br>        <span class="cell" name"cell"="" id="c11"></span><br>        <span class="cell" name"cell"="" id="c12"></span><br>        <span class="cell" name"cell"="" id="c13"></span><br>        <span class="cell" name"cell"="" id="c14"></span><br>    </div><br>    <div class="row"><br>        <span class="cell" id="c21"></span><br>        <span class="cell" id="c22"></span><br>        <span class="cell" id="c23"></span><br>        <span class="cell" id="c24"></span><br>    </div><br>    <div class="row"><br>        <span class="cell" id="c31"></span><br>        <span class="cell" id="c32"></span><br>        <span class="cell" id="c33"></span><br>        <span class="cell" id="c34"></span><br>    </div><br>    <div class="row"><br>        <span class="cell" id="c41"></span><br>        <span class="cell" id="c42"></span><br>        <span class="cell" id="c43"></span><br>        <span class="cell" id="c44"></span><br>    </div><br></div><br></body>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://johnfanyong.github.io/2015/02/05/2048/" data-id="zdubblyoyiuix1sb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2015/02/05/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/02/05/2048/">(no title)</a>
          </li>
        
          <li>
            <a href="/2015/02/05/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>